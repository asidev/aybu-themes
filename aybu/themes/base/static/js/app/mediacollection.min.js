Ext.ns("Aybu.MediaCollection.MediaItemPage");Aybu.MediaCollection.MediaItemPage.Window=Ext.extend(Aybu.Base.Window,{constructor:function(a){this.collectionSelector=a.collectionSelector;this.lightBoxSelector=a.lightBoxSelector;Aybu.MediaCollection.MediaItemPage.Window.superclass.constructor.call(this,a)},initComponent:function(){var a={title:"Gestione Galleria",width:220,items:{xtype:"AybuBasePanel",cls:"images-view",enableDD:true,tbar:{buttonsCfg:{add:true,edit:true,delete_:true}},items:{xtype:"AybuBaseDataView",emptyText:'<div class="plupload_emptytext"><span>Galleria vuota.</span></div>',tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="MediaItemPage{id}">','<tpl for="file">','<div class="thumb"><img src="{thumb_url}"></div>',"</tpl>",'<tpl for="translations">','<span class="label"><b>{label}</b></span></div>',"</tpl>","</div>","</tpl>",'<div class="x-clear"></div>'),store:{xtype:"AybuBaseStore",idProperty:"id",baseParams:{parent_url:document.URL},httpProxyUrl:"/admin/mediaitempage",fields:[{name:"id",type:"int"},"file","parent_url","translations",{name:"weight",type:"int"}],sortInfo:{field:"weight",direction:"ASC"}}},addWindow:new Aybu.Image.Window({modal:true}),editWindow:new Aybu.Base.EditWindow({modal:true,width:520,items:{xtype:"AybuBaseEditPanel",items:[{xtype:"textfield",itemId:"labelField",width:350,name:"label",fieldLabel:"Titolo",allowBlank:false,labelStyle:"font-weight: bold"},{xtype:"textarea",itemId:"contentField",width:350,height:250,name:"content",fieldLabel:"Descrizione",allowBlank:true,labelStyle:"font-weight: bold"},{xtype:"hidden",itemId:"idField",name:"id",allowBlank:false}],getValues:function(){return{id:this.getComponent("idField").getValue(),label:this.getComponent("labelField").getValue(),content:this.getComponent("contentField").getValue()}},},setRecord:function(b){this.getComponent(0).getForm().setValues({id:b.data.id,label:b.data.translations[0].label,content:b.data.translations[0].content})}}),onDeleteSelected:function(){},onSelectionDone:function(f){var c=this.getComponent("dataview");var e=c.getStore();var j=e.getTotalCount();e.sort("weight","ASC");var b=e.getAt(j-1);var h=1;if(b){h+=b.data.weight}var d=[];for(i=0;i<f.length;i++){var g={file:{id:f[i].data.id,url:f[i].data.url,thumb_url:f[i].data.thumb_url},parent_url:document.URL,translations:[{label:"",content:""}],weight:h+i};g=new e.recordType(g);d.push(g)}e.add(d);e.save()},onEditDone:function(d){var c=this.getComponent("dataview").getStore();if(d){var b=c.getById(d.id);b.set("translations",[{id:b.data.translations[0].id,label:d.label,content:d.content}])}c.save();this.editWindow.hide()}}};Ext.apply(this,Ext.apply(this.initialConfig,a));Aybu.MediaCollection.MediaItemPage.Window.superclass.initComponent.apply(this,arguments)},onDataChange:function(){Ext.Ajax.request({url:mcp_urls.show_html_view,params:{response_format:"html",},method:"GET",failure:function(){Ext.Msg.alert("Errore: refresh non riuscito.","Non Ã¨ stato possibile aggiornare il contenuto della galleria visualizzato all'interno della pagina del sito.")},success:function(a,b){jQuery(this.collectionSelector).replaceWith(a.responseText);jQuery(this.lightBoxSelector).lightBox()},scope:this})},});Ext.reg("MediaItemPageWindow",Aybu.MediaCollection.MediaItemPage.Window);